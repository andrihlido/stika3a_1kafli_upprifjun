<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stika 3a - Kafli 3</title>
    
    <!-- Sækjum React og Tailwind af netinu -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Smá hreyfingar */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-teal-100 min-h-screen font-sans text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Einfölduð SVG til að sleppa við innflutning) ---
        const Icons = {
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>,
            Calc: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>,
            Divide: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="6" r="1"></circle><line x1="5" y1="12" x2="19" y2="12"></line><circle cx="12" cy="18" r="1"></circle></svg>,
            Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>,
            Car: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2"></path><circle cx="6.5" cy="16.5" r="2.5"></circle><circle cx="16.5" cy="16.5" r="2.5"></circle></svg>,
            Droplets: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"></path><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"></path></svg>,
            ArrowRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            Trophy: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v3a5 5 0 0 1-10 0V4"></path><path d="M17 4a5 5 0 0 0 4 4v2a5 5 0 0 1-10 0V8"></path><path d="M7 4a5 5 0 0 1-4 4v2a5 5 0 0 0 10 0V8"></path></svg>,
            Layers: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
        };

        // --- SPURNINGAGRUNNUR (KAFLI 3) ---
        const questionsData = [
            // Silja Safi
            {
                id: 101, topic: "Hlutföll", type: "input",
                question: "Silja blandar saman safa og vatni í hlutfallinu 1 : 6. Hve mikið vatn þarf hún á móti 3 dl af safa?",
                acceptedAnswers: ["18"],
                explanation: "Hlutfallið er 1 á móti 6. Fyrir 3 dl af safa þarf: 3 · 6 = 18 dl af vatni.",
                icon: <Icons.Droplets />
            },
            {
                id: 102, topic: "Hlutföll", type: "input",
                question: "Hlutfallið er 1 : 6. Hve mikið vatn þarf Silja á móti 1,5 dl af safa?",
                acceptedAnswers: ["9"],
                explanation: "Reiknum: 1,5 · 6. \n(1 · 6 = 6) og (0,5 · 6 = 3). \n6 + 3 = 9 dl.",
                icon: <Icons.Droplets />
            },
            // Boltar
            {
                id: 103, topic: "Hlutföll", type: "visual-ratio",
                question: "Finndu hlutfallið milli grænna og fjólublárra boltana.",
                visualData: { green: 4, purple: 12 },
                options: ["1 : 4", "1 : 3", "1 : 2", "4 : 16"],
                correctIndex: 1,
                explanation: "4 grænir og 12 fjólubláir = 4 : 12. \nDeilum með 4 báðum megin: 1 : 3.",
                icon: <div className="w-6 h-6 bg-purple-500 rounded-full"></div>
            },
            // Bíll
            {
                id: 104, topic: "Hlutföll", type: "input",
                question: "Bíl er ekið 225 km vegalengd á 3 klukkutímum. Hve langt fer bíllinn á 5 klukkustundum með sama hraða?",
                acceptedAnswers: ["375"],
                explanation: "Fyrst finnum við hraðann á 1 tíma: 225 : 3 = 75 km/klst. \nSvo 5 tíma: 75 · 5 = 375 km.",
                icon: <Icons.Car />
            },
            // Möguleikar
            {
                id: 105, topic: "Möguleikar", type: "multiple-choice",
                question: "Í sjoppunni eru 3 tegundir af pylsum og 2 tegundir af brauði. Hve margir eru möguleikarnir á að velja sér pylsu?",
                options: ["5", "6", "9", "1"],
                correctIndex: 1,
                explanation: "Margföldum valmöguleikana: 3 (pylsur) · 2 (brauð) = 6 möguleikar.",
                icon: <Icons.Utensils />
            },
            {
                id: 106, topic: "Möguleikar", type: "input",
                question: "Á veitingahúsi eru 4 forréttir, 5 aðalréttir og 2 eftirréttir. Hve margar mismunandi máltíðir er hægt að velja?",
                acceptedAnswers: ["40"],
                explanation: "Margföldum allt saman: 4 · 5 · 2 = 40 möguleikar.",
                icon: <Icons.Utensils />
            },
            // Margföldun
            {
                id: 108, topic: "Margföldun", type: "input",
                question: "Reiknaðu: 17 · 35",
                acceptedAnswers: ["595"],
                explanation: "10 · 35 = 350. \n7 · 35 = 245. \n350 + 245 = 595.",
                icon: <Icons.Calc />
            },
            {
                id: 109, topic: "Margföldun", type: "input",
                question: "Reiknaðu: 6 · 3,4",
                acceptedAnswers: ["20.4", "20,4"],
                explanation: "6 · 3 = 18. \n6 · 0,4 = 2,4. \n18 + 2,4 = 20,4.",
                icon: <Icons.Calc />
            },
            // Tugabrot margföldun
            {
                id: 1, topic: "Tugabrot", type: "input",
                question: "Reiknaðu: 0,5 · 0,4",
                acceptedAnswers: ["0.2", "0,2", "0.20", "0,20"],
                explanation: "5 · 4 = 20. \nTveir aukastafir: 0,20 eða 0,2.",
                icon: <Icons.Calc />
            },
            // Forgangsröð
            {
                id: 8, topic: "Forgangsröð", type: "multiple-choice",
                question: "Reiknaðu: 4 + 4 · 4 - 4",
                options: ["28", "16", "12", "0"],
                correctIndex: 1,
                explanation: "Margföldun fyrst! \n4 · 4 = 16. \n4 + 16 - 4 = 16.",
                icon: <Icons.Calc />
            },
            // Frumtölur
            {
                id: 107, topic: "Frumtölur", type: "multiple-choice",
                question: "Hverjar af eftirfarandi tölum eru frumtölur? (24, 45, 61, 101)",
                options: ["24 og 45", "61 og 101", "Aðeins 101", "45 og 61"],
                correctIndex: 1,
                explanation: "61 og 101 eru frumtölur (aðeins deilanlegar með 1 og sjálfri sér).",
                icon: <Icons.Layers />
            }
        ];

        // --- GAME COMPONENT ---
        function MathGame() {
            const [gameState, setGameState] = useState('start');
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [inputAnswer, setInputAnswer] = useState('');
            const [selectedOption, setSelectedOption] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [isCorrect, setIsCorrect] = useState(false);
            const [questions, setQuestions] = useState([]);

            useEffect(() => {
                setQuestions([...questionsData].sort(() => 0.5 - Math.random()));
            }, []);

            const startGame = () => {
                setQuestions([...questionsData].sort(() => 0.5 - Math.random()));
                setGameState('playing');
                setCurrentQIndex(0);
                setScore(0);
                resetState();
            };

            const resetState = () => {
                setInputAnswer('');
                setSelectedOption(null);
                setShowFeedback(false);
                setIsCorrect(false);
            };

            const checkInput = (user, correct) => {
                if(!user) return false;
                const norm = (s) => s.toLowerCase().replace(/km|dl|kr|\s/g, '').replace(/,/g, '.');
                return correct.some(c => norm(user) === norm(c));
            };

            const submit = () => {
                const q = questions[currentQIndex];
                let correct = false;
                if(q.type === 'input') correct = checkInput(inputAnswer, q.acceptedAnswers);
                else correct = selectedOption === q.correctIndex;

                setIsCorrect(correct);
                if(correct) setScore(s => s + 1);
                setShowFeedback(true);
            };

            const next = () => {
                if(currentQIndex < questions.length - 1) {
                    setCurrentQIndex(prev => prev + 1);
                    resetState();
                } else {
                    setGameState('finished');
                }
            };

            if(questions.length === 0) return null;
            const q = questions[currentQIndex];

            // Render Start Screen
            if(gameState === 'start') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-4">
                    <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-lg w-full text-center animate-fadeIn">
                        <div className="w-24 h-24 bg-emerald-500 rounded-2xl rotate-6 flex items-center justify-center mx-auto mb-6 shadow-lg">
                            <div className="text-white"><Icons.Divide /></div>
                        </div>
                        <h1 className="text-4xl font-extrabold text-slate-800 mb-2">Kafli 3</h1>
                        <h2 className="text-xl text-emerald-600 font-bold mb-6">Margföldun og deiling</h2>
                        <button onClick={startGame} className="bg-emerald-600 hover:bg-emerald-700 text-white text-lg font-bold py-3 px-8 rounded-xl shadow-lg transition-transform transform hover:-translate-y-1 active:scale-95 flex items-center justify-center mx-auto">
                            <span className="mr-2"><Icons.Play /></span> Byrja Leik
                        </button>
                    </div>
                </div>
            );

            // Render Finished Screen
            if(gameState === 'finished') return (
                <div className="flex flex-col items-center justify-center min-h-screen p-4">
                    <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-lg w-full text-center animate-fadeIn">
                        <div className="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <div className="text-yellow-600"><Icons.Trophy /></div>
                        </div>
                        <h2 className="text-3xl font-bold text-slate-800 mb-2">Æfingu Lokið!</h2>
                        <div className="text-5xl font-black text-emerald-600 mb-4">{score} / {questions.length}</div>
                        <p className="text-slate-600 mb-8">Vel gert! Haltu áfram að æfa þig.</p>
                        <button onClick={startGame} className="bg-white border-2 border-slate-200 hover:border-emerald-500 text-slate-600 font-bold py-3 px-8 rounded-xl transition flex items-center justify-center mx-auto">
                            <span className="mr-2"><Icons.Refresh /></span> Spila aftur
                        </button>
                    </div>
                </div>
            );

            // Render Playing Screen
            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-4">
                    <div className="w-full max-w-2xl bg-white rounded-3xl shadow-xl overflow-hidden border border-emerald-100">
                        {/* Progress */}
                        <div className="bg-slate-100 h-2 w-full">
                            <div className="bg-emerald-500 h-full transition-all duration-500" style={{width: `${(currentQIndex / questions.length) * 100}%`}}></div>
                        </div>
                        
                        {/* Header */}
                        <div className="px-6 py-4 flex justify-between items-center border-b border-slate-100">
                            <div className="text-sm font-bold text-slate-400 uppercase">Dæmi {currentQIndex + 1} / {questions.length}</div>
                            <div className="flex items-center space-x-2 bg-emerald-50 px-3 py-1 rounded-full text-emerald-700 font-bold text-sm">
                                <span>{score} stig</span>
                            </div>
                        </div>

                        <div className="p-6 md:p-10">
                            {/* Topic */}
                            <div className="flex justify-center mb-6">
                                <div className="inline-flex items-center space-x-2 bg-slate-100 px-4 py-1.5 rounded-full text-sm font-semibold text-slate-600">
                                    <span className="text-emerald-500">{q.icon}</span>
                                    <span>{q.topic}</span>
                                </div>
                            </div>

                            {/* Question */}
                            <h2 className="text-2xl font-bold text-center text-slate-800 mb-8">{q.question}</h2>

                            {/* Visuals */}
                            {q.type === 'visual-ratio' && (
                                <div className="mb-8 p-6 bg-slate-50 rounded-xl flex flex-col items-center">
                                    <div className="flex gap-2 mb-4 flex-wrap justify-center">
                                        {[...Array(q.visualData.green)].map((_,i) => <div key={i} className="w-8 h-8 rounded-full bg-green-500 border-2 border-green-600 flex items-center justify-center text-white text-xs font-bold">G</div>)}
                                    </div>
                                    <div className="w-full h-0.5 bg-slate-200 mb-4"></div>
                                    <div className="flex gap-2 flex-wrap justify-center">
                                        {[...Array(q.visualData.purple)].map((_,i) => <div key={i} className="w-8 h-8 rounded-full bg-purple-500 border-2 border-purple-600 flex items-center justify-center text-white text-xs font-bold">F</div>)}
                                    </div>
                                </div>
                            )}

                            {/* Inputs */}
                            {q.type === 'input' && (
                                <div className="mb-10 flex justify-center">
                                    <input 
                                        type="text" 
                                        value={inputAnswer}
                                        onChange={e => setInputAnswer(e.target.value)}
                                        onKeyDown={e => {
                                            if(e.key === 'Enter') {
                                                if(!showFeedback && inputAnswer) submit();
                                                else if(showFeedback) next();
                                            }
                                        }}
                                        disabled={showFeedback}
                                        placeholder="Skrifaðu svar..."
                                        className={`w-full max-w-xs text-center text-2xl p-4 rounded-xl border-2 outline-none transition-all ${
                                            showFeedback 
                                            ? (isCorrect ? 'border-green-500 bg-green-50 text-green-800' : 'border-red-500 bg-red-50 text-red-800')
                                            : 'border-slate-300 focus:border-emerald-500'
                                        }`}
                                        autoFocus
                                    />
                                </div>
                            )}

                            {(q.type === 'multiple-choice' || q.type === 'visual-ratio') && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10">
                                    {q.options.map((opt, idx) => {
                                        let cls = "border-slate-200 hover:border-emerald-400 text-slate-700";
                                        if(selectedOption === idx) cls = "border-emerald-500 bg-emerald-50 text-emerald-900";
                                        if(showFeedback) {
                                            if(idx === q.correctIndex) cls = "border-green-500 bg-green-100 text-green-900 font-bold";
                                            else if(selectedOption === idx) cls = "border-red-500 bg-red-100 text-red-900 opacity-70";
                                            else cls = "border-slate-100 text-slate-400 opacity-50";
                                        }
                                        return (
                                            <button key={idx} onClick={() => !showFeedback && setSelectedOption(idx)} disabled={showFeedback}
                                                className={`p-4 rounded-xl text-lg font-medium border-2 transition-all text-left flex justify-between items-center ${cls}`}>
                                                {opt}
                                                {showFeedback && idx === q.correctIndex && <span className="text-green-600"><Icons.Check /></span>}
                                                {showFeedback && selectedOption === idx && idx !== q.correctIndex && <span className="text-red-500"><Icons.X /></span>}
                                            </button>
                                        )
                                    })}
                                </div>
                            )}

                            {/* Action Bar */}
                            <div className="flex justify-center md:justify-end">
                                {!showFeedback ? (
                                    <button onClick={submit} disabled={q.type === 'input' ? !inputAnswer : selectedOption === null}
                                        className={`px-8 py-3 rounded-xl font-bold text-white text-lg transition-all shadow-lg ${
                                            (q.type === 'input' ? inputAnswer : selectedOption !== null) 
                                            ? 'bg-emerald-600 hover:bg-emerald-700 hover:-translate-y-1' 
                                            : 'bg-slate-300 cursor-not-allowed'
                                        }`}>
                                        Svara
                                    </button>
                                ) : (
                                    <button onClick={next} autoFocus className="px-8 py-3 rounded-xl font-bold text-white text-lg bg-slate-800 hover:bg-slate-900 shadow-lg flex items-center hover:-translate-y-1 transition-all">
                                        <span>{currentQIndex < questions.length - 1 ? "Næsta" : "Ljúka"}</span>
                                        <span className="ml-2"><Icons.ArrowRight /></span>
                                    </button>
                                )}
                            </div>

                            {/* Feedback */}
                            {showFeedback && (
                                <div className={`mt-8 p-6 rounded-2xl animate-fadeIn ${isCorrect ? 'bg-green-50' : 'bg-red-50'}`}>
                                    <div className="flex gap-4">
                                        <div className={`p-2 rounded-full h-fit ${isCorrect ? 'bg-green-200 text-green-700' : 'bg-red-200 text-red-700'}`}>
                                            {isCorrect ? <Icons.Check /> : <Icons.X />}
                                        </div>
                                        <div>
                                            <h3 className={`font-bold text-lg ${isCorrect ? 'text-green-800' : 'text-red-800'}`}>{isCorrect ? 'Rétt!' : 'Því miður...'}</h3>
                                            <p className="text-slate-700 mt-1 whitespace-pre-line">{q.explanation}</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MathGame />);
    </script>
</body>
</html>